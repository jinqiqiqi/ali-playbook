<?php


ini_set('date.timezone','Asia/Shanghai');

$notify = new SlackNotificationCmd();


while( !feof(STDIN) && $line = fgets(STDIN) ) {

    // log ips from access log.
    $notify->cmd($line);
    

}

class SlackNotificationCmd {
    function __construct() {
        
    }
    
    function cmd($line) {
        $data = $this->parseContent($line);
        error_log(print_r($data, 1), 3, "/var/log/d.syslog");
        
    }
    
    private function parseContent($content = "") {
        $data = array();
        if(!empty($content)) {
            $tmp = explode("^^^^", $content);
            $data['body'] = $tmp[1];
            $tmp1 = explode("^", $tmp[0]);
            $data['time'] = $tmp1[0];
            $data['facility'] = $tmp1[1];
            $data['procid'] = $tmp1[2];
            $data['fromhost-ip'] = $tmp1[3];
            $data['hostname'] = $tmp1[4];
            $data['syslogtag'] = $tmp1[5];
            $data['syslogpriority'] = $tmp1[6];
        }
        
        return $data;
    }
}
